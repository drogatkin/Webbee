<?xml version="1.0" encoding="utf-8"?>
 <!DOCTYPE bee PUBLIC "-//Dmitriy Rogatkin//DTD Bee Project Builder 1.0//EN"
    "http://knitknot.info/DTD/bee.dtd" [
      <!ENTITY env SYSTEM "./env.xml">
      <!ENTITY project "webbee">
      <!ENTITY build_directory "build/out">
      <!ENTITY source_directory "src/java"> <!-- change if differs -->
      <!ENTITY build_file "&project;.jar"> <!-- change if differs -->
      <!ENTITY domain "com">
      <!ENTITY manifestf "">
      <!ENTITY main_class "">
      <!ENTITY webapp_file "&project;.war"> <!-- change if differs -->
      ]>
<!-- 
   Build script file used for "WebBee" project
   Copyright (c) 2008-2015 Dmitriy Rogatkin    -->

<bee name="&project;" type="project" dir="..">
  &env;

  <expression variable="javac">
     <operator name="append">
        <value variable="JAVA_HOME"/>
        <value>/bin/javac</value>
     </operator>
  </expression>

  <target name="create" dir="..">
     <dependency>true</dependency>
     <block>
       <echo>Welcome to a new project template creation wizard</echo>
       <echo>Tips: use only a single word in lower case letters for answers</echo>
       <variable name="projects root"/>
       <expression name="projects root">
          <operator name="append">
             <function name="ask">
                 <parameter>Enter Webbee suite root directory [../..]?</parameter>
                 <parameter type="path">../../</parameter>
             </function>
           </operator> 
       </expression>
       <expression name="project name">
           <function name="ask">
                 <parameter>Enter project's name [test]?</parameter>
                 <parameter>test</parameter>
           </function>
       </expression>
       <expression name="C project name">
           <function name="string">
                 <parameter variable="project name"/>
                 <parameter>capital</parameter>
           </function>
       </expression>

       <expression name="org name">
           <function name="ask">
                 <parameter>Enter your organization name [webbee]?</parameter>
                 <parameter>test</parameter>
           </function>
       </expression>
       <expression name="project directory">
          <operator name="append">
             <value variable="projects root"/>
             <value>/</value>
             <value variable="project name"/>
          </operator>
       </expression>
       <if>
         <expression>
           <operator name="neq">
              <function name="timestamp">
                 <parameter variable="project directory"/>
              </function>
              <value></value>
           </operator >
         </expression>
         <then>
           <if>
             <expression>
               <operator name="eq">
                  <function name="ask">
                     <parameter>The project directory already exists, please confirm that you want to overwwrite it [n]? </parameter>
                     <parameter>n</parameter>
                  </function>
                  <value>n</value>
               </operator>
             </expression>
             <then>
                <function name="stop">
                  <parameter>-1</parameter>
                </function>
             </then>
           </if>
         </then>
       </if>
       <function name="mkd">
          <parameter variable="project directory"/>
       </function>
       <variable name="project folders">build,doc,src,src/res,src/res/cfg,src/res/css,src/res/html,src/res/image,src/res/text,src/res/text,src/res/text/data,src/res/view,src/res/view/insert,src/res/view/portal,src/res/view/mobile,src/java,src/js</variable>
       <for variable="folder" in="project folders" separator=",">
         <block>
           <expression name="target folder">
              <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value variable="folder"/>
              </operator>
           </expression> 
           <!--echo variable="target folder"/-->
           <function name="mkd">
              <parameter variable="target folder"/>
           </function>
          </block>
       </for>
       <expression name="bunit name">
           <function name="ask">
                 <parameter>Enter your business unit name []?</parameter>
                 <parameter></parameter>
           </function>
       </expression>
       <expression name="org path">
            <value variable="org name"/>
       </expression>
       <if>
          <expression>
             <operator  name="neq">
                <value></value>
                <value variable="bunit name"/>
             </operator>
          </expression>
          <then>
             <expression name="org name">
                <operator name="append">
                   <value variable="org name"/> 
                   <value>.</value>
                   <value variable="bunit name"/>
                </operator>
              </expression>
             <expression name="org path">
                <operator name="append">
                   <value variable="org path"/> 
                   <value>/</value>
                   <value variable="bunit name"/>
                </operator>
              </expression>
          </then>
       </if> 
       <expression name="project domain">
           <function name="ask">
                 <parameter>Enter project's domain [com]?</parameter>
                 <parameter>com</parameter>
           </function>
       </expression>
       <expression name="db code">
           <function name="ask">
                 <parameter>Provide database type used, one of h2, ora, my, hado, none [ora]?</parameter>
                 <parameter>ora</parameter>
           </function>
       </expression>
       <expression name="behav pub">
           <function name="ask">
                 <parameter>Does the application require user authentication [y]?</parameter>
                 <parameter>y</parameter>
           </function>
       </expression>
       <expression name="use dropdown">
           <function name="ask">
                 <parameter>Will your application use dropdowns [y]?</parameter>
                 <parameter>y</parameter>
           </function>
       </expression>
       <expression name="mobile">
           <function name="ask">
                 <parameter>Is mobile support required [n]?</parameter>
                 <parameter>n</parameter>
           </function>
       </expression>

       <expression name="class folders">
         <operator name="append">
             <value value="ux,model,model/util,serv"/>             
         </operator>
       </expression>

       <for variable="folder" in="class folders" separator=",">
         <block>
           <expression name="target folder">
              <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="src/java/"/>
                 <value variable="project domain"/>
                 <value>/</value>
                 <value variable="org path"/>
                 <value>/</value>
                 <value variable="project name"/>
                 <value>/</value>
                 <value variable="folder"/>
              </operator>
           </expression> 
           <!--echo variable="target folder"/-->
           <function name="mkd">
              <parameter variable="target folder"/>
           </function>
          </block>
       </for>
       <expression name="wrk file">
          <operator name="append">
                 <value variable="project directory"/>
                 <value>/sequence.cnt</value>
          </operator>
       </expression>
       <function name="write">
          <parameter variable="wrk file"/>
          <parameter>1</parameter>
       </function>

       <expression variable="model class">
           <operator name="append">
             <value>// Webbee (C) 2015 Dmitriy Rogatkin
///////   application model class   //////////
// TODO modify the file for the application purpose
package </value>
             <value variable="project domain"/>
             <value>.</value>
             <value variable="org name"/>
             <!-- <value variable="bunit name"/> -->  
             <value>.</value>
             <value variable="project name"/>
             <value>.model;
</value>
             <value>
import javax.sql.DataSource;
import org.aldan3.data.DOService;
import org.aldan3.model.Log;

import com.beegman.webbee.model.AppModel;
import com.beegman.webbee.model.Auth;
import com.beegman.webbee.base.BaseBehavior;

import </value>
             <value variable="project domain"/>
             <value>.</value>
             <value  variable="org name"/>
             <value>.</value>
             <value variable="project name"/>
             <value>.model.util.</value>
             <value variable="C project name"/>
             <value>Behavior;
public class </value>
             <value variable="C project name"/>
             <value>Model extends AppModel {

	@Override
	public String getAppName() {
		return "</value>
             <value variable="C project name"/>
             <value>";
	}
	
	@Override
	protected String getServletName() {
		return "Webbee servlet";
	}
 
	@Override
	protected DOService createDataService(DataSource datasource) {
		return new DOService(datasource) {
</value>
             <expression>
                 <switch variable="db code">
                   <block type="case" value="h2">
                       <value>
                     @Override      
                     public String normalizeElementName(String name) {
                         return name.toUpperCase();
                     }
                     
                     @Override
		     protected int getInsertUpdateVariant() {
		          return 2;
		     }
</value>
                   </block>
                   <block type="case" value="my">
                       <value>
                     @Override
                     protected int getInsertUpdateVariant() {
	          	return 0;
	             }
</value>
                   </block>
                   <block type="case" value="ora">
                       <value>
                     @Override
                     protected int getInsertUpdateVariant() {
	          	return 1;
	             }
</value>
                   </block>
                 </switch>
             </expression>
                <value>
                };
        }

	@Override
        public BaseBehavior getCommonBehavior() {
		return new </value>
             <value variable="C project name"/>
             <value>Behavior ();
	}

	@Override
	protected void initServices() {
		super.initServices();
	}
</value>
             <expression>
                <if>
                  <expression>
                     <operator name="eq">
                        <value variable="behav pub"/>
                         <value>y</value>
                      </operator>
                   </expression>
                   <then>
                      <value>
    @Override
	public Auth getAuth() {
	        // TODO override the class to conduct authentication
	        // see AD/LDAP plug-in com.beegman.webbee.util.LDAPAuth
		return super.getAuth();
    } 
                      </value>
                    </then>
                </if>
             </expression>
             <value>
}</value>         
           </operator>
       </expression>
       
       <expression name="wrk file">
          <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="src/java/"/>
                 <value variable="project domain"/>
                 <value>/</value>
                 <value variable="org path"/>
                 <value>/</value>
                 <value variable="project name"/>
                 <value>/model/</value>
                 <value variable="C project name"/>
                 <value>Model.java</value>
          </operator>
       </expression>
       <function name="write">
         <parameter variable="wrk file"/>
         <parameter variable="model class"/>
       </function>
       <expression name="wrk file">
          <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="src/java/"/>
                 <value variable="project domain"/>
                 <value>/</value>
                 <value variable="org path"/>
                 <value>/</value>
                 <value variable="project name"/>
                 <value>/model/util/</value>
                 <value variable="C project name"/>
                 <value>Behavior.java</value>
          </operator>
       </expression>
       <function name="write">
         <parameter variable="wrk file"/>
         <parameter>// Webbee (C) 2015 Dmitriy Rogatkin
///////   application common behavior class   //////////
// TODO modify the file for the application behavior purpose
package </parameter>
             <parameter variable="project domain"/>
             <parameter>.</parameter>
             <parameter variable="org name"/>
             <parameter>.</parameter>
             <parameter variable="project name"/>
             <parameter>.model.util;
import com.beegman.webbee.base.BaseBehavior;
import </parameter>
             <parameter variable="project domain"/>
             <parameter>.</parameter>
             <parameter variable="org name"/>
             <parameter>.</parameter>
             <parameter variable="project name"/>
             <parameter>.model.</parameter>
             <parameter variable="C project name"/>
             <parameter>Model;

public class </parameter>
             <parameter variable="C project name"/>
             <parameter>Behavior extends BaseBehavior&lt;</parameter>
             <parameter variable="C project name"/>
             <parameter>Model&gt; {
    public </parameter>
             <parameter variable="C project name"/>
             <parameter>Behavior () {
         super();
             </parameter>
             <parameter> 
               <expression>
               <if>
                  <expression>
                     <operator name="neq">
                          <value variable="behav pub"/>
                          <value>y</value>
                      </operator>
                  </expression>
                  <then>
                     <expression>
                        <value>  
        isPublic = true;
</value>
                     </expression>
                  </then>
               </if>
               </expression>
            </parameter>
            <parameter>
    }
}
</parameter>
       </function>
       <if>
          <expression>
            <operator name="or">
               <operator name="neq">
                  <value variable="db code"/>
                  <value>none</value>
                </operator>
               <operator name="neq">
                  <value variable="db code"/>
                  <value>hado</value>
                </operator>
             </operator>
           </expression>
           <then>
                <expression name="wrk file">
                    <operator name="append">
                      <value variable="project directory"/>
                      <value>/</value>
                      <value value="src/java/"/>
                      <value variable="project domain"/>
                      <value>/</value>
                      <value variable="org path"/>
                      <value>/</value>
                      <value variable="project name"/>
                      <value>/ux/Schemainit.java</value>
                  </operator>
               </expression>
               <function name="write">
                  <parameter variable="wrk file"/>
                  <parameter>package </parameter>
                  <parameter variable="project domain"/>
                  <parameter>.</parameter>
                  <parameter variable="org name"/>
                  <parameter>.</parameter>
                  <parameter variable="project name"/>
                  <parameter>.ux;

import com.beegman.webbee.block.Systemsetup;
import com.beegman.webbee.model.Setup;
import </parameter>
                  <parameter variable="project domain"/>
                  <parameter>.</parameter>
                  <parameter variable="org name"/>
                  <parameter>.</parameter>
                  <parameter variable="project name"/>
                  <parameter>.model.</parameter>
                  <parameter variable="C project name"/>
                  <parameter>Model;

public class Schemainit extends Systemsetup&lt;Setup, </parameter>
                  <parameter variable="C project name"/>
                  <parameter>Model&gt; {

	@Override
	protected String getDefaultModelPackage() {
             return getAppModel().getClass().getPackage().getName();
        }
}
</parameter>
               </function>
                <expression name="wrk file">
                    <operator name="append">
                      <value variable="project directory"/>
                      <value>/</value>
                      <value value="src/res/view/schemainit.html"/>
                  </operator>
               </expression>
               <function name="write">
                  <parameter variable="wrk file"/>
                  <parameter>@%'systemsetup.htmt'@</parameter>
               </function>
                <expression name="wrk file">
                    <operator name="append">
                      <value variable="project directory"/>
                      <value>/</value>
                      <value value="src/res/text/schemainit.properties"/>
                  </operator>
               </expression>
               <function name="cp">
                   <parameter type="path">src/res/text/systemsetup.properties</parameter>
                   <parameter variable="wrk file"/>
               </function>
           </then>
       </if>
       <expression name="wrk file">
          <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="src/res/cfg/"/>
                 <value variable="project name"/>
                 <value>.properties</value>
         </operator>
       </expression>
       <function name="write">
         <parameter variable="wrk file"/>
         <parameter>#
PresentServicePackage=</parameter>
         <parameter variable="project domain"/>
         <parameter>.</parameter>
         <parameter variable="org name"/>
         <parameter>.</parameter>
         <parameter variable="project name"/>
         <parameter>.ux.

RESOURCEROOT=/WEB-INF/res/text

TEMPLATEROOT=/WEB-INF/res/view

viewext=.html

CommonBehaviorClass=</parameter>
         <parameter variable="project domain"/>
         <parameter>.</parameter>
         <parameter variable="org name"/>
         <parameter>.</parameter>
         <parameter variable="project name"/>
         <parameter>.model.util.</parameter>
         <parameter variable="C project name"/>
         <parameter>Behavior

#perspective_separator=/

#stationary=

#copyright=

#public_home=

#attach_home=

#public_canvas=

</parameter>
         <parameter>
            <expression> 
            <if>
               <expression>
                  <operator name="neq">
                      <value>y</value>
                      <value variable="mobile"/>
                  </operator>
               </expression>
               <then>
                  <value>#</value>
               </then>
             </if>
            </expression>
          </parameter>
          <parameter>mobile_support=yes

#logoff=Signoff

DEBUG=1
</parameter>
       </function>
       <expression name="wrk file">
          <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="src/res/view/canvas.html"/>
          </operator>
       </expression>
       <function name="write">
         <parameter variable="wrk file"/>
         <parameter>@%'canvas.htmt'@
</parameter>
       </function>
       <expression name="wrk file">
          <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="src/res/text/fastaccessbuttons.properties"/>
          </operator>
       </expression>
       <function name="write">
         <parameter variable="wrk file"/>
         <parameter/>
       </function>
        <if>
           <expression>
               <operator name="eq">
                   <value variable="behav pub"/>
                   <value>y</value>
               </operator>
           </expression>
           <then>
               <function name="writea">
                  <parameter variable="wrk file"/>
                  <parameter>button_logoff=Logoff, Log off, Log off current session
</parameter>
              </function>
          </then>
       </if>        
       <expression name="wrk file">
          <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="src/res/cfg/web.xml"/>
          </operator>
       </expression>
       <expression name="db name">
          <switch variable="db code">
             <block type="case" value="h2">
               <value>h2</value>
             </block>
             <block type="case" value="my">
               <value>mysql</value>
             </block>
             <block type="case" value="ora">
               <value>oracle</value>
             </block>
          </switch>
       </expression>
       <function name="write">
         <parameter variable="wrk file"/>
         <parameter>&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
	metadata-complete="true"&gt;

	&lt;context-param&gt;
		&lt;param-name&gt;model_datasource&lt;/param-name&gt;
		&lt;param-value>jdbc/</parameter>
        <parameter variable="db name"/>
        <parameter>/</parameter>
        <parameter variable="project name"/>
        <parameter>&lt;/param-value&gt;
	&lt;/context-param&gt;
	&lt;listener&gt;
		&lt;listener-class></parameter>
          <parameter variable="project domain"/>
          <parameter>.</parameter>
          <parameter variable="org name"/>
          <parameter>.</parameter>
          <parameter variable="project name"/>
          <parameter>.model.</parameter>
          <parameter variable="C project name"/>
          <parameter>Model&lt;/listener-class&gt;
	&lt;/listener&gt;
	&lt;servlet&gt;
                &lt;servlet-name&gt;Webbee servlet&lt;/servlet-name&gt;
		&lt;description&gt;Webbee main servlet&lt;/description&gt;
		&lt;servlet-class&gt;com.beegman.webbee.base.WebApp&lt;/servlet-class&gt;
		&lt;init-param>
			&lt;param-name&gt;properties&lt;/param-name&gt;
			&lt;param-value&gt;/WEB-INF/config/</parameter>
          <parameter variable="project name"/>
          <parameter>.properties&lt;/param-value&gt;
		&lt;/init-param&gt;
		&lt;async-supported>true&lt;/async-supported&gt;
	&lt;/servlet&gt;
	&lt;servlet-mapping&gt;
		&lt;servlet-name&gt;Webbee servlet&lt;/servlet-name&gt;
		&lt;url-pattern&gt;/webbee/*&lt;/url-pattern&gt;
	&lt;/servlet-mapping&gt;
	&lt;welcome-file-list&gt;
		&lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
	&lt;/welcome-file-list&gt;
	&lt;resource-ref&gt;
		&lt;res-ref-name&gt;java:comp/env/jdbc/</parameter>
        <parameter variable="db name"/>
        <parameter>/</parameter>
        <parameter variable="project name"/>
        <parameter>&lt;/res-ref-name&gt;
		&lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
		&lt;res-auth&gt;Container&lt;/res-auth&gt;
	&lt;/resource-ref&gt;
&lt;/web-app&gt;
           </parameter>
        </function>
       <expression name="wrk file">
          <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="bee.xml"/>
          </operator>
       </expression>
       <expression name="file prot">
	       <if>
	           <expression>
	               <operator name="eq">
	                   <value>/</value>
	                   <value name="file.separator" type="property"/>
	               </operator>
	           </expression>
	           <then>
	               <variable>file:</variable>
	           </then>
	           <else>
	               <variable>file:</variable>
	           </else>
	       </if>
       </expression>
       <variable name="conf header">&lt;?xml version="1.0"?&gt;
 &lt;!DOCTYPE bee PUBLIC "-//Dmitriy Rogatkin//DTD Bee Project Builder 1.0//EN"
    "http://knitknot.info/DTD/bee.dtd" [
      &lt;!ENTITY env SYSTEM "./env.xml"&gt;
      &lt;!ENTITY project "</variable>
       <expression variable="conf header">
          <operator name="append">
             <value variable="conf header"/>
             <value variable="project name"/>
             <value>"&gt;
      &lt;!ENTITY build_directory "./build"&gt;
      &lt;!ENTITY source_directory "src/java"&gt;
      &lt;!ENTITY build_file "&amp;project;.jar"&gt; 
      &lt;!ENTITY domain "</value>
             <value variable="project domain"/>
             <value>"&gt;
      &lt;!ENTITY org "</value>
             <value variable="org name"/>
             <value>"&gt;
      &lt;!ENTITY manifestf ""&gt;
      &lt;!ENTITY org_path "</value>
             <value variable="org path"/>
             <value>"&gt;
      &lt;!ENTITY wizard SYSTEM "</value>
             <value variable="file prot"/> 
             <value variable="WEBBEE_HOME"/>
             <value>/build/wizard.xml"&gt;
      &lt;!ENTITY main_class "&amp;domain;.&amp;org;.&amp;project;.Main"&gt;
      &lt;!ENTITY webapp_file "&amp;project;.war"&gt; 
      &lt;!ENTITY projects_root "</value>
            <value variable=""/>
            <value>"&gt;
      ]>
</value>
         </operator>
       </expression>
       <function name="write">
           <parameter variable="wrk file"/>
           <parameter variable="conf header"/>
       </function>
       <function name="cpa">
           <parameter type="dir">bee.proj.tmpl</parameter>
           <parameter variable="wrk file"/>
       </function>
       <expression name="wrk file">
          <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="env.xml"/>
          </operator>
       </expression>
       <function name="write">
           <parameter variable="wrk file"/>
           <parameter>   &lt;variable name="WEBBEE_HOME" type="path"&gt;</parameter>
           <parameter variable="WEBBEE_HOME"/>
           <parameter>&lt;/variable&gt;
   &lt;variable name="ALDAN3_HOME" type="path"&gt;</parameter>
           <parameter variable="ALDAN3_HOME"/>
           <parameter>&lt;/variable&gt;
   &lt;variable name=&quot;JDBC_DRIVER&quot;</parameter>
           <parameter>
             <expression>
                <switch variable="db code">
                   <block type="case" value="h2">
                       <expression>
                         <value> type=&quot;repo_artifact&quot;&gt;maven:com.h2database:h2:1.4.189&lt;/variable&gt;
</value>
                       </expression>
                   </block>
                   <block type="case" value="my">
                       <expression>
                         <value> type=&quot;repo_artifact&quot;&gt;maven:mysql:mysql-connector-java:5.1.6&lt;/variable&gt;
</value>
                       </expression>
                   </block>
                   <block type="case" value="ora">
                       <expression>
                         <value>Modify me and add driver downloaded from http://www.oracle.com/technetwork/database/features/jdbc/default-2280470.html&lt;/variable&gt;
</value>
                       </expression>
                   </block>
                   <block type="default">
                       <expression>
                          <value>&gt;&lt;/variable&gt;</value>
                       </expression>
                   </block>
                </switch>
              </expression>
            </parameter>
       </function>
       <function name="cpa">
           <parameter type="path">build/env.proj.tmpl</parameter>
           <parameter variable="wrk file"/>        
       </function>

       <expression name="wrk file">
          <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="src/res/html/index.html"/>
         </operator>
       </expression>
       <function name="write">
         <parameter variable="wrk file"/>
         <parameter>&lt;!DOCTYPE html&gt;
&lt;html&gt;
   &lt;head&gt;
      &lt;title&gt;Welcome to </parameter>
         <parameter variable="C project name"/>
         <parameter>&lt;/title&gt; 
   &lt;/head&gt;
      &lt;body&gt; 
         &lt;h2&gt;Welcome to </parameter>
         <parameter variable="C project name"/>
         <parameter>&lt;/h2&gt; 
           &lt;a href=&quot;/</parameter>
         <parameter variable="project name"/>
         <parameter>/webbee/&quot;&gt;Click here&lt;/a&gt; to access( append UI service name) &lt;br/&gt;&lt;a href=&quot;/</parameter>
         <parameter variable="project name"/>
         <parameter>/webbee/Schemainit&quot;&gt;Prepare schema&lt;/a&gt; 
      &lt;/body&gt;
&lt;/html&gt;
         </parameter>
       </function>
       <if>
          <expression>
            <operator name="or">
                <operator name="neq">
                   <value variable="db code"/>
                  <value>none</value>
               </operator>
                <operator name="neq">
                   <value variable="db code"/>
                  <value>hado</value>
               </operator>
           </operator>
         </expression>
         <then>
            <expression name="wrk file">
              <operator name="append">
                 <value variable="project directory"/>
                 <value>/</value>
                 <value value="src/res/cfg/context.xml"/>
              </operator>
            </expression>
            <function name="write">
               <parameter variable="wrk file"/>
               <parameter>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Context&gt;
    &lt;!-- Specify a JDBC datasource --&gt;
</parameter>
            </function>
         </then>
       </if>
       <switch variable="db code">
          <block type="case" value="h2">
            <function name="writea">
               <parameter variable="wrk file"/>
               <parameter>&lt;Resource name=&quot;jdbc/h2/</parameter>
               <parameter variable="project name"/>
               <parameter>&quot; 
              auth=&quot;Container&quot;
              type=&quot;javax.sql.DataSource&quot;
              username=&quot;sa&quot;
              password=&quot;&quot;
              driverClassName=&quot;org.h2.Driver&quot;
              driverClassPath=&quot;Application&quot;
              url=&quot;jdbc:h2:~/</parameter>
               <parameter variable="project name"/>
              <parameter>&quot;
              validationQuery=&quot;select 1&quot;
              maxActive=&quot;3&quot;
              maxIdle=&quot;2&quot;/&gt;
&lt;/Context&gt;
</parameter>
            </function>
          </block>
          <block type="case" value="ora">
            <function name="writea">
               <parameter variable="wrk file"/>
               <parameter>&lt;Resource name=&quot;jdbc/oracle/</parameter>
               <parameter variable="project name"/>
               <parameter>&quot; 
              auth=&quot;Container&quot;
              type=&quot;javax.sql.DataSource&quot;
              username=&quot;</parameter>
               <parameter variable="project name"/>
               <parameter>&quot;
              password=&quot;</parameter>
              <parameter>
                 <function name="ask">
                     <parameter>Oracle password []?</parameter>
                     <parameter/>
                 </function>
              </parameter>
              <parameter>&quot;
              driverClassName=&quot;oracle.jdbc.driver.OracleDriver&quot;
              driverClassPath=&quot;Application&quot;
              url=&quot;jdbc:oracle:thin:@//localhost:1521/XE&quot;
              validationQuery=&quot;select 1 from dual&quot;
              maxActive=&quot;3&quot;
              maxIdle=&quot;2&quot;/&gt;
&lt;/Context&gt;
</parameter>
            </function>
          </block>
          <block type="case" value="my">
            <function name="writea">
               <parameter variable="wrk file"/>
               <parameter>&lt;Resource name=&quot;jdbc/mysql/</parameter>
               <parameter variable="project name"/>
               <parameter>&quot; 
              auth=&quot;Container&quot;
              type=&quot;javax.sql.DataSource&quot;
              username=&quot;root&quot;
              password=&quot;&quot;
              driverClassName=&quot;com.mysql.jdbc.Driver&quot;
              driverClassPath=&quot;Application&quot;
              url=&quot;jdbc:mysql://localhost:3306/</parameter>
               <parameter variable="project name"/>
              <parameter>?autoReconnect=true&amp;amp;zeroDateTimeBehavior=convertToNull&quot;
              validationQuery=&quot;select 1&quot;
              maxActive=&quot;10&quot;
              maxIdle=&quot;4&quot;/&gt;
&lt;/Context&gt;
</parameter>
            </function>
          </block>
       </switch>
       <if>
          <expression>
             <operator name="eq">
               <value>y</value>
               <value variable="use dropdown"/>
            </operator>
          </expression>
          <then>
             <expression name="wrk file">
                <operator name="append">
                    <value variable="project directory"/>
                     <value>/</value>
                     <value value="src/res/text/data/listslabels.properties"/>
                </operator>
             </expression>
             <function name="write">
                <parameter variable="wrk file"/>
                <parameter># add entires for lists/dropdowns in form field_name=value1,label1,value2,label2,...
</parameter>
             </function>
           </then> 
       </if>
       <expression name="done mess">
         <operator name="append">
           <value>
A new </value>
           <value variable="project name"/>
           <value> application template has been created in </value>
           <value variable="project directory"/>
           <value>
Navigate to 
cd </value>
           <value variable="project directory"/>
           <value>
and execute
bee create
to build application objects, and
bee deploy
to deploy and test the applicaiton</value>
         </operator>  
       </expression>
       <echo variable="done mess"/>
     </block>
  </target>

  <target name="check build" dir="WEBBEE_HOME">
     <dependency>
        <expression>
          <operator name="eq">
            <function name ="timestamp">
               <parameter value="&build_directory;" type="path"/>
            </function>
            <value></value>
          </operator>
        </expression>
     </dependency>
     <block>
       <function name="mkd">
         <parameter value="&build_directory;" type="path"/>
       </function>
     </block>
  </target>

  <!-- reconsider in case of not project root build script -->
  <expression variable="java sources">
        <function name="newerwithdependency">
           <parameter value="&source_directory;/&domain;/.java" type="path"/>
           <parameter value="&build_directory;/&domain;/.class" type="path"/>
	   <parameter/>
	   <parameter value="&domain;"/>
        </function>
  </expression>

  <expression variable="class path">
     <operator name="append">
        <value variable="WEBBEE_HOME"/>
        <value>/&build_directory;</value>
        <value variable="PATH SEPARATOR"/>
        <value variable="CUSTOM CP"/>
     </operator>
  </expression>

  <target name="compile" dir="WEBBEE_HOME">
    <dependency target="check build"/>
    <dependency variable="java sources"/>
    <echo>Compiling...</echo>
    <task exec="javac">
       <parameter value="-classpath"/>
       <parameter variable="class path"/>
       <parameter value="-source"/>
       <parameter value="1.6"/>
       <parameter value="-target"/>
       <parameter variable="comp target"/>
       <parameter value="-d"/>comp target
       <parameter value="&build_directory;" type="path"/>
       <parameter variable="java sources"/>>
      <onexit>
        <if>
          <expression>
             <operator name="neq"><value variable="resultcode"/><value>0</value></operator>
          </expression>
          <block type="then">
                 <echo>Error(s) at compilation</echo>
                 <function name="stop">
			<parameter value="1"/>
                 </function>
          </block>
       </if>
      </onexit>
      <onexception>
	<block>
                 <echo>Exception at compilation</echo>
                 <function name="stop">
			<parameter value="-1"/>
                 </function>
	</block>
      </onexception>
    </task>
  </target>

  <expression variable="manifest file">
     <value type="path">&manifestf;</value>
  </expression>

  <target name="jar" dir="WEBBEE_HOME">
    <echo>Jarring...</echo>
    <dependency target="compile"/>
    <dependency>
           <function name="allnewer">
              <parameter value="&build_directory;/&domain;" type="dir"/>
              <parameter value="&build_directory;/&build_file;" type="path"/>
           </function>
    </dependency>
    <dependency>
           <function name="allnewer">
              <parameter value="bee.xml" type="dir"/>
              <parameter value="&build_directory;/&build_file;" type="path"/>
           </function>
    </dependency>

    <task name="jar_do" code="sun.tools.jar.Main">
       <parameter>
          <expression>
            <if>
              <expression>
                <operator name="eq">
                  <value/>
                  <value variable="manifest file"/>
                </operator>
              </expression>
              <block type="then">
                <value>-cf</value>
              </block>
              <block type="else">
                <operator name="array">
	           <value>-cmf</value>
                   <value variable="manifest file"/>
                 </operator>
              </block>
            </if>
          </expression>
       </parameter>   
       <parameter value="&build_directory;/&build_file;" type="path"/>
       <parameter value="-C"/>
       <parameter value="&build_directory;" type="path"/>
       <parameter value="&domain;"/>
      <onexception>
	<block>
                 <echo>Exception at jarring</echo>
                 <function name="stop">
			<parameter value="-1"/>
                 </function>
	</block>
      </onexception>
    </task>
  </target>

  <target name="clean" dir="WEBBEE_HOME">
    <dependency>
       <expression>
         <operator name="eq">
            <value>y</value>  
            <function name="ask">
               <parameter value="Are you sure to remove all files in &build_directory; [n]?"/>
               <parameter value="n"/>
            </function>
        </operator>
      </expression>
    </dependency>
    <block>
      <echo>Cleaning...</echo>
      <function name="rm">
         <parameter value="&build_directory;/*/*//*/*/*.class" type="path"/>
         <parameter value="&build_directory;/&build_file;" type="path"/>
         <parameter value="&build_directory;/&webapp_file;" type="path"/>
      </function>
    </block>
  </target>

  <expression variable="rt class path">
     <operator name="append">
        <value variable="class path"/>
        <value variable="PATH SEPARATOR"/>
        <value value="&build_directory;/&build_file;" type="path"/>
    </operator>
  </expression>

  <target name="tools" dir="WEBBEE_HOME">
    <dependency target="war"/>
    <dependency>true</dependency>
    <task name="main" code="com.beegman.webbee.tool.ConvTool" path="rt class path">
       <parameter variable="~#args#~"/>
    </task>
  </target>



  <expression variable="appserver class path">
     <operator name="append">
        <value variable="TJWS_HOME"/>
        <value>/lib/webserver.jar</value>
        <value variable="PATH SEPARATOR"/>
        <value variable="TJWS_HOME"/>
        <value>/lib/war.jar</value>
        <value variable="PATH SEPARATOR"/>
        <value variable="TJWS_HOME"/>
        <value>/lib/app.jar</value>
        <value variable="PATH SEPARATOR"/>
        <value variable="SERVLET_LIB"/>
     </operator>
  </expression>

  <target name="run" dir="WEBBEE_HOME">
    <echo>Running web app &project; ...</echo>
    <dependency target="war"/>
    <dependency value="true"/>
    <task name="main" code="rogatkin.app.Main" path="appserver class path">
       <parameter name="rogatkin.web.WebAppServlet.debug" value="yes"/>
       <parameter name="tjws.webappdir" value="&build_directory;" type="path"/>
       <parameter name="java.awt.headless" value="true"/>
       <parameter name="tjws.wardeploy.dynamically" value="10"/>
       <parameter>-dataSource</parameter>
       <parameter type="path">src/res/cfg/datasource.properties</parameter>
       <parameter value="-p"/>
       <parameter>
         <expression>
           <if>
             <expression>
               <value name="secure" type="property"/>
             </expression>
             <block type="then">
                <variable name="port" value="443"/>
             </block>
             <block type="else">
                <variable name="port">80</variable>
             </block>
           </if>
         </expression>
       </parameter>
       <parameter value="-l"/>
       <parameter>
          <expression variable="secure socket">
           <if>
             <expression>
               <value name="secure" type="property"/>
             </expression>
             <block type="then">
                <expression variable="secure socket">
                  <operator name="array">
                      <value>-acceptorImpl</value>
                      <value>Acme.Serve.SSLAcceptor</value>
                      <value>-keystorePass</value>
                      <value variable="key pass"/>
                  </operator>
                </expression>
             </block>
           </if>
         </expression>
      </parameter>
      <parameter value="-j"/>
      <parameter value="org.apache.jasper.servlet.JspServlet"/>
      <parameter value="-org.apache.jasper.servlet.JspServlet.classpath"/>
      <parameter value="%classpath%"/>
      <parameter value="-org.apache.jasper.servlet.JspServlet.scratchdir"/>
      <parameter value="%deploydir%/WEB-INF"/>
    </task>
  </target>  

  <expression name="ALDAN3_LIB">
     <operator name="append">
        <value variable="ALDAN3_HOME"/>
        <value>/build/aldan3.jar</value>
     </operator>
  </expression>

  <target name="war" dir="WEBBEE_HOME">
    <dependency target="jar"/>
    <dependency>
       <expression>
          <operator name="not">
             <function name ="timestamp">
                <parameter value="&build_directory;/&webapp_file;" type="path"/>
             </function>
          </operator>
       </expression>
    </dependency>
    <dependency>
       <expression>
          <operator name="or">
             <function name="anynewer">
                <parameter variable="src/res/html" type="path"/>
                <parameter value="&build_directory;/&webapp_file;" type="path"/>
             </function>
             <function name="anynewer">
                <parameter value="src/res/cfg" type="path"/>
                <parameter value="&build_directory;/&webapp_file;" type="path"/>
             </function>
          </operator>
       </expression>
    </dependency>
    <dependency>
       <expression>
          <function name="anynewer">
             <parameter value="src/res/template/insert" type="path"/>
             <parameter value="&build_directory;/&webapp_file;" type="path"/>
          </function>
       </expression>
    </dependency>
    <dependency>
       <expression>
          <function name="anynewer">
             <parameter value="src/res/template" type="path"/>
             <parameter value="&build_directory;/&webapp_file;" type="path"/>
          </function>
       </expression>
    </dependency>
    <dependency>
       <expression>
          <function name="anynewer">
             <parameter value="src/res/css" type="path"/>
             <parameter value="&build_directory;/&webapp_file;" type="path"/>
          </function>
       </expression>
    </dependency>
    <dependency>
       <expression>
          <function name="anynewer">
             <parameter value="src/res/image" type="path"/>
             <parameter value="&build_directory;/&webapp_file;" type="path"/>
          </function>
       </expression>
    </dependency>
    <dependency>
       <expression>
          <function name="anynewer">
             <parameter value="src/res/text" type="path"/>
             <parameter value="&build_directory;/&webapp_file;" type="path"/>
          </function>
       </expression>
    </dependency>
    <dependency>
       <expression>
          <function name="anynewer">
             <parameter variable="ALDAN3_LIB" type="path"/>
             <parameter value="&build_directory;/&webapp_file;" type="path"/>
          </function>
       </expression>
    </dependency>
    <block>
      <echo value="...->&build_directory;/&webapp_file;"/>
      <function name="warit">
         <parameter value="&build_directory;/&webapp_file;" type="path"/>
         <parameter type="path">src/res/cfg/web.xml</parameter>
         <parameter>C &domain;</parameter>
         <parameter type="path">&build_directory;/&domain;</parameter>
         <parameter/>
         <parameter>L</parameter>
         <parameter variable="CUSTOM CP" type="array" separator="PATH SEPARATOR"/>
         <parameter/>
         <parameter>A WEB-INF/config/</parameter>
         <parameter type="path">src/res/cfg/&project;.properties</parameter>
         <!-- template resources -->
         <parameter>A WEB-INF/res/template/insert</parameter>
         <parameter type="path">src/res/template/insert/*.htmt</parameter>
         <parameter>A WEB-INF/res/template/insert</parameter>
         <parameter type="path">src/res/template/insert/*.json</parameter>
         <parameter>A WEB-INF/res/template</parameter>
         <parameter type="path">src/res/template/*.htmt</parameter>
         <parameter>A WEB-INF/res/template/portlet</parameter>
         <parameter type="path">src/res/template/portlet/*.htmt</parameter>
         <!-- text/labels properties resources -->
         <parameter>E WEB-INF/res/text/</parameter>
         <parameter type="path">src/res/text/*.properties</parameter>
         <parameter>commonlabels.properties</parameter>
         <parameter>A WEB-INF/res/text/</parameter>
         <parameter type="path">src/res/text/commonlabels.properties</parameter>
         <parameter>A WEB-INF/res/text/data</parameter>
         <parameter type="path">src/res/text/data/*.properties</parameter>

         <!-- image resources -->
         <parameter>A image/</parameter>
         <parameter type="path">src/res/image/*.gif</parameter>
         <parameter>A image/</parameter>
         <parameter type="path">src/res/image/*.jpg</parameter>
         <parameter>A image/</parameter>
         <parameter type="path">src/res/image/*.png</parameter>
         <parameter>A image/</parameter>
         <parameter type="path">src/res/image/*.jpeg</parameter>

         <parameter>A</parameter>
         <parameter type="path">src/res/html/*.html</parameter>
         <parameter>A css/</parameter>
         <parameter type="path">src/res/css/*.css</parameter>
         <parameter>A js/</parameter>
         <parameter type="path">src/js/*.js</parameter>
         <!-- 3rd parties (not yet) -->
         <parameter>A js/</parameter>
         <parameter type="path">src/3rdparty/htmlencoder/*.js</parameter>
         <!-- Prototype (not in use)  -->
      </function>
    </block>
  </target>
</bee>

